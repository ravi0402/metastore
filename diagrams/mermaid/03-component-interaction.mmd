sequenceDiagram
    participant Client
    participant Kong as Kong Gateway
    participant Metadata as Metadata Service
    participant Cache as Aerospike Cache
    participant DB as PostgreSQL
    participant Kafka
    participant Search as Search Service
    participant ES as Elasticsearch
    
    Client->>Kong: HTTP Request (JWT Token)
    Kong->>Kong: Validate Auth & Rate Limit
    Kong->>Metadata: Route to Metadata Service
    
    alt Read Operation
        Metadata->>Cache: Check L2 Cache
        alt Cache Hit
            Cache-->>Metadata: Return Cached Data
            Metadata-->>Client: Response
        else Cache Miss
            Metadata->>DB: Query PostgreSQL
            DB-->>Metadata: Return Data
            Metadata->>Cache: Store in Cache
            Metadata-->>Client: Response
        end
    else Write Operation
        Metadata->>DB: Write to PostgreSQL
        DB-->>Metadata: Confirm Write
        Metadata->>Kafka: Publish Change Event
        Metadata-->>Client: Response (sync done)
        Note over Kafka,ES: Async Processing (Different Services)
        Kafka-->>Search: Search Service consumes event
        Search->>ES: Update Elasticsearch index
        Kafka-->>Cache: Cache invalidation event
    end
